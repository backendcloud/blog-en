<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Openstack Placement - English version of the website https://www.backendcloud.cn/</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');
                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }
                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../SUMMARY.html"><strong aria-hidden="true">1.</strong> Catalog: Openstack</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../openstack/placement.html" class="active"><strong aria-hidden="true">1.1.</strong> Openstack Placement</a></li><li class="chapter-item expanded "><a href="../openstack/power-arch.html"><strong aria-hidden="true">1.2.</strong> POWER architecture server as computing node</a></li><li class="chapter-item expanded "><a href="../openstack/sriov.html"><strong aria-hidden="true">1.3.</strong> OpenStack practices SR-IOV computing nodes</a></li><li class="chapter-item expanded "><a href="../openstack/openstack-op-4.html"><strong aria-hidden="true">1.4.</strong> Openstack operation and maintenance records (4)</a></li><li class="chapter-item expanded "><a href="../openstack/openstack-op-3.html"><strong aria-hidden="true">1.5.</strong> Openstack operation and maintenance records (3)</a></li><li class="chapter-item expanded "><a href="../openstack/openstack-op-2.html"><strong aria-hidden="true">1.6.</strong> Openstack operation and maintenance records (2)</a></li><li class="chapter-item expanded "><a href="../openstack/openstack-op-1.html"><strong aria-hidden="true">1.7.</strong> Openstack operation and maintenance records (1)</a></li><li class="chapter-item expanded "><a href="../openstack/novnc-problem.html"><strong aria-hidden="true">1.8.</strong> OpenStack Pike dashboard noVNC cannot be accessed problem</a></li><li class="chapter-item expanded "><a href="../openstack/openstack-local-yum.html"><strong aria-hidden="true">1.9.</strong> Openstack Pike local yum source construction</a></li><li class="chapter-item expanded "><a href="../openstack/cpu-binding.html"><strong aria-hidden="true">1.10.</strong> CPU binding</a></li><li class="chapter-item expanded "><a href="../openstack/resize-fail.html"><strong aria-hidden="true">1.11.</strong> Investigation of the cause of resize failure</a></li><li class="chapter-item expanded "><a href="../openstack/mount-cloud-disk.html"><strong aria-hidden="true">1.12.</strong> Mount cloud disk</a></li><li class="chapter-item expanded "><a href="../openstack/ocata-nova-evacuate-bug.html"><strong aria-hidden="true">1.13.</strong> Ocata nova evacuate bug</a></li><li class="chapter-item expanded "><a href="../openstack/compute-node-ha.html"><strong aria-hidden="true">1.14.</strong> compute node ha mainstream open source implementation</a></li><li class="chapter-item expanded "><a href="../openstack/collectd-influxdb.html"><strong aria-hidden="true">1.15.</strong> Deployment and usage of Collectd and InfluxDB</a></li><li class="chapter-item expanded "><a href="../openstack/live-migration-local.html"><strong aria-hidden="true">1.16.</strong> Live Migration on Local Storage</a></li><li class="chapter-item expanded "><a href="../openstack/fast-evacuation.html"><strong aria-hidden="true">1.17.</strong> Add fast evacuation function to VM HA procedure</a></li><li class="chapter-item expanded "><a href="../openstack/vm-activation-failure.html"><strong aria-hidden="true">1.18.</strong> Windows virtual machine activation failure problem</a></li></ol></li><li class="chapter-item expanded "><a href="../SUMMARY.html"><strong aria-hidden="true">2.</strong> Catalog: Point of view</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../point-of-view/huawei-and-operators.html"><strong aria-hidden="true">2.1.</strong> Huawei and telecom operators</a></li></ol></li><li class="chapter-item expanded "><a href="../SUMMARY.html"><strong aria-hidden="true">3.</strong> Catalog: Tools</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../tools/git-dir.html"><strong aria-hidden="true">3.1.</strong> Internal structure of .git directory</a></li><li class="chapter-item expanded "><a href="../tools/xshell-skill.html"><strong aria-hidden="true">3.2.</strong> Some Skills of using xshell tools</a></li><li class="chapter-item expanded "><a href="../tools/gerrit-install.html"><strong aria-hidden="true">3.3.</strong> gerrit install</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">English version of the website https://www.backendcloud.cn/</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <p>release time :2019-04-18 09:14</p>
<p>The main content of this article is transferred from the article of Huawei Fan Guixiong.  </p>
<h1 id="background"><a class="header" href="#background">background</a></h1>
<p>Private cloud users, especially private cloud users undergoing traditional IT architecture transformation, generally have a variety of stock resource systems, and connecting with these systems will complicate the OpenStack resource system.</p>
<p>From the user's point of view, you may want to:</p>
<p>As a user of shared storage solutions, you would expect Nova and Horizon to correctly report the total and usage information of shared storage disk resources.
As an advanced Neutron user, it is expected to use an external third-party routing network function. I hope that Nova can grasp and use a specific network port to associate with a specific subnet pool to ensure that the virtual machine can be started on the subnet pool.
As an advanced Cinder user, I hope that when I specify cinder volume-id in the nova boot command, Nova can know which computing nodes are associated with the Cinder storage pool where the Request Volume is located.
Therefore, in addition to processing internal resources such as computing node CPU, memory, PCI devices, and local disks, OpenStack often needs to manage external resources such as storage services provided by SDS and NFS, and network services provided by SDN.</p>
<p>But in the past, Nova can only handle resources provided by computing nodes. Nova Resource Tracker assumes that all resources come from computing nodes. Therefore, when reporting resource status periodically, Resource Tracker will simply add statistics on the total resources and usage of the computing node list. Obviously, this cannot meet the complex production requirements mentioned above, and also violates the openness principle that OpenStack has always been proud of. And as the definition of OpenStack is further upgraded by the community to &quot;an open source infrastructure integration engine&quot;, it means that the resource system of OpenStack will be composed of more external resource types.</p>
<p>Therefore, when resource types and providers become diverse, a highly abstract and simple and unified management method is naturally required to allow users and codes to easily use, manage, and monitor the entire OpenStack system resources. This is Placement (layout) ).</p>
<h1 id="project-description"><a class="header" href="#project-description">Project Description</a></h1>
<p>Placement shoulders such a historical mission. It was first introduced into the openstack/nova repo in the Newton version and incubated in the form of API, so it is often called Placement API. It participates in the scheduling process of nova-scheduler selecting the target host, is responsible for tracking and recording the Inventory and Usage of the Resource Provider, and uses different Resource Classes to classify resource types, and uses different Resource Traits to mark resource characteristics.</p>
<p>The Ocata version of the Placement API is optional, and users are advised to enable and replace CpuFilter, CoreFilter, and DiskFilter. The Pike version is mandatory to start the Placement API service, otherwise the nova-compute service cannot run normally.</p>
<p>Placement API started the openstack/nova repo spin-off process, transformed from Placement API to OpenStack Placement, and became a separate project in the Stein release.</p>
<h1 id="community-development"><a class="header" href="#community-development">community development</a></h1>
<p>Starting from the S version, Placement has released the first official version 1.0.0. The Placement code is hosted in its own warehouse and managed as an independent OpenStack project.</p>
<p>Most of the changes in the S version are not user-oriented, but the migration of internal data from nova to placement.</p>
<p>The S version has a total of 338 commits, the following is the company's participation.</p>
<p>https://www.stackalytics.com/?module=placement&amp;release=stein&amp;metric=commits</p>
<pre><code>Contribution Summary
Commits: 338
LOCs: 61838
Do not merge (-2): 2
Patch needs further work (-1): 154
Looks good (+1): 313
Looks good for core (+2): 649
Approve: 305
Abandon: 0
Change Requests: 350 (30 of them abandoned)
Patch Sets: 1320
Draft Blueprints: 0
Completed Blueprints: 0
Filed Bugs: 0
Resolved Bugs: 0
Emails: 0
Translations: 0
</code></pre>
<p>#working principle
nova-compute reports resource information to placement. Nova-scheduler still uses partially reserved filters and weights while asking placement for nodes that satisfy a series of resource requests. (Currently placement only replaces the commonly used filters of nova-scheduler's CpuFilter, CoreFilter and DiskFilter)</p>
<p>Nova-scheduler makes two calls to placement-api. For the first time, nova-scheduler obtains a set of Allocation Candidates (allocation candidates) from placement-api. The so-called Allocation Candidates are Resource Providers that can meet resource requirements.</p>
<p>EXAMPLE:</p>
<pre><code>GET /allocation_candidates?resources=VCPU:1,MEMORY_MB:2048,DISK_GB:100
</code></pre>
<p>NOTE: The implementation of obtaining Allocation Candidates is a series of complex database cascading query and filtering operations, using query params as filtering conditions. This example passes the vCPU, RAM, and Disk resources required by the Launch Instance. In addition, the required and member_of parameters can also be provided to specify the Resource Traits and Resource Provider Aggregate characteristics, making the acquisition of Allocation Candidates more flexible. See Allocation candidates for more details.</p>
<pre><code>[root@control01 ~]# openstack allocation candidate list --resource VCPU=1,MEMORY_MB=2048,DISK_GB=10 --required HW_CPU_X86_SSE2
+---+----------------------------------+--------------------------------------+----------------------------------------------+--------------------------------------------------------------+
| # | allocation                       | resource provider                    | inventory used/capacity                      | traits                                                       |
+---+----------------------------------+--------------------------------------+----------------------------------------------+--------------------------------------------------------------+
| 1 | VCPU=1,MEMORY_MB=2048,DISK_GB=10 | 5c5a578f-51b0-481c-b38c-7aaa3394e585 | VCPU=5/512,MEMORY_MB=3648/60670,DISK_GB=7/49 | HW_CPU_X86_SSE2,HW_CPU_X86_SSE,HW_CPU_X86_MMX,HW_CPU_X86_SVM |
+---+----------------------------------+--------------------------------------+----------------------------------------------+--------------------------------------------------------------+
</code></pre>
<p>The JSON object with a list of allocation requests and a JSON object of provider summary objects returned by placement-api to nova-scheduler has the following data structure, the key lies in the two fields of allocation_requests and provider_summaries, which also play an important role in the subsequent Scheduler Filters logic role.</p>
<pre><code>{
&quot;allocation_requests&quot;: [
    &lt;ALLOCATION_REQUEST_1&gt;,
    ...
    &lt;ALLOCATION_REQUEST_N&gt;
],
&quot;provider_summaries&quot;: {
    &lt;COMPUTE_NODE_UUID_1&gt;: &lt;PROVIDER_SUMMARY_1&gt;,
    ...
    &lt;COMPUTE_NODE_UUID_N&gt;: &lt;PROVIDER_SUMMARY_N&gt;,
}
}
</code></pre>
<p>allocation_requests: Contains a list of all resource providers that can meet the requirements and their expected allocation resources.</p>
<pre><code>&quot;allocation_requests&quot;: [
        {
            &quot;allocations&quot;: {
                &quot;a99bad54-a275-4c4f-a8a3-ac00d57e5c64&quot;: {
                    &quot;resources&quot;: {
                        &quot;DISK_GB&quot;: 100
                    }
                },
                &quot;35791f28-fb45-4717-9ea9-435b3ef7c3b3&quot;: {
                    &quot;resources&quot;: {
                        &quot;VCPU&quot;: 1,
                        &quot;MEMORY_MB&quot;: 1024
                    }
                }
            }
        },
        {
            &quot;allocations&quot;: {
                &quot;a99bad54-a275-4c4f-a8a3-ac00d57e5c64&quot;: {
                    &quot;resources&quot;: {
                        &quot;DISK_GB&quot;: 100
                    }
                },
                &quot;915ef8ed-9b91-4e38-8802-2e4224ad54cd&quot;: {
                    &quot;resources&quot;: {
                        &quot;VCPU&quot;: 1,
                        &quot;MEMORY_MB&quot;: 1024
                    }
                }
            }
        }
    ],
</code></pre>
<p>provider_summaries: Contains the total resources and usage information of all resource providers that meet the requirements.</p>
<pre><code>&quot;provider_summaries&quot;: {
        &quot;a99bad54-a275-4c4f-a8a3-ac00d57e5c64&quot;: {
            &quot;resources&quot;: {
                &quot;DISK_GB&quot;: {
                    &quot;used&quot;: 0,
                    &quot;capacity&quot;: 1900
                }
            },
            &quot;traits&quot;: [&quot;MISC_SHARES_VIA_AGGREGATE&quot;],
            &quot;parent_provider_uuid&quot;: null,
            &quot;root_provider_uuid&quot;: &quot;a99bad54-a275-4c4f-a8a3-ac00d57e5c64&quot;
        },
        &quot;35791f28-fb45-4717-9ea9-435b3ef7c3b3&quot;: {
            &quot;resources&quot;: {
                &quot;VCPU&quot;: {
                    &quot;used&quot;: 0,
                    &quot;capacity&quot;: 384
                },
                &quot;MEMORY_MB&quot;: {
                    &quot;used&quot;: 0,
                    &quot;capacity&quot;: 196608
                }
            },
            &quot;traits&quot;: [&quot;HW_CPU_X86_SSE2&quot;, &quot;HW_CPU_X86_AVX2&quot;],
            &quot;parent_provider_uuid&quot;: null,
            &quot;root_provider_uuid&quot;: &quot;35791f28-fb45-4717-9ea9-435b3ef7c3b3&quot;
        },
        &quot;915ef8ed-9b91-4e38-8802-2e4224ad54cd&quot;: {
            &quot;resources&quot;: {
                &quot;VCPU&quot;: {
                    &quot;used&quot;: 0,
                    &quot;capacity&quot;: 384
                },
                &quot;MEMORY_MB&quot;: {
                    &quot;used&quot;: 0,
                    &quot;capacity&quot;: 196608
                }
            },
            &quot;traits&quot;: [&quot;HW_NIC_SRIOV&quot;],
            &quot;parent_provider_uuid&quot;: null,
            &quot;root_provider_uuid&quot;: &quot;915ef8ed-9b91-4e38-8802-2e4224ad54cd&quot;
        },
        &quot;f5120cad-67d9-4f20-9210-3092a79a28cf&quot;: {
            &quot;resources&quot;: {
                &quot;SRIOV_NET_VF&quot;: {
                    &quot;used&quot;: 0,
                    &quot;capacity&quot;: 8
                }
            },
            &quot;traits&quot;: [],
            &quot;parent_provider_uuid&quot;: &quot;915ef8ed-9b91-4e38-8802-2e4224ad54cd&quot;,
            &quot;root_provider_uuid&quot;: &quot;915ef8ed-9b91-4e38-8802-2e4224ad54cd&quot;
        }
    }
</code></pre>
<p>NOTE: It can be seen that SRIOV_NET_VF is also regarded as a resource type, provided by a dedicated resource provider.</p>
<p>After nova-scheduler obtains the Allocation Candidates, it further uses the Filtered and Weighed mechanisms to finally determine the target host. Then deduct (claim_resources) the resource usage of the resource provider corresponding to the target host according to the data of allocation requests and provider summaries, which is what nova-scheduler calls placement-api for the second time. Review the contents of the allocations tables:</p>
<pre><code>MariaDB [nova_api]&gt; select * from allocations;
+---------------------+------------+----+----------------------+--------------------------------------+-------------------+------+
| created_at          | updated_at | id | resource_provider_id | consumer_id                          | resource_class_id | used |
+---------------------+------------+----+----------------------+--------------------------------------+-------------------+------+
| 2018-08-01 10:52:15 | NULL       |  7 |                    1 | f8d55035-389c-47b8-beea-02f00f25f5d9 |                 0 |    1 |
| 2018-08-01 10:52:15 | NULL       |  8 |                    1 | f8d55035-389c-47b8-beea-02f00f25f5d9 |                 1 |  512 |
| 2018-08-01 10:52:15 | NULL       |  9 |                    1 | f8d55035-389c-47b8-beea-02f00f25f5d9 |                 2 |    1 |
+---------------------+------------+----+----------------------+--------------------------------------+-------------------+------+
# consumer_id consumer
# resource_class_id resource type
# resource_provider_id resource provider
# used allocated amount
# The above records indicate that 1 vCPU, RAM 512MB, and Disk 1GB are allocated to the virtual machine
Obviously, the Consumer consumer is the virtual machine to be created.
</code></pre>
<h1 id="software-installation"><a class="header" href="#software-installation">Software Installation</a></h1>
<p>1 Create a database</p>
<p>To create a database, complete the following steps:</p>
<p><strong>Connect to the database server as root using the database access client:</strong></p>
<pre><code>$ mysql -u root -p
</code></pre>
<p><strong>Grant appropriate access to the database:</strong></p>
<pre><code>MariaDB [(none)]&gt; CREATE DATABASE placement;
</code></pre>
<p><strong>Exit the database access client.</strong></p>
<p>2 Configure users and endpoints</p>
<p>1)Source admin credentials to access admin-only CLI commands:</p>
<pre><code>$ .admin-openrc
</code></pre>
<p>2)Create the Placement service user PLACEMENT_PASS with your choice:</p>
<p>$ openstack user create --domain default --password-prompt placement</p>
<pre><code>User Password:
Repeat User Password:
+---------------------+----------------------------------+
| Field               | Value                            |
+---------------------+----------------------------------+
| domain_id           | default                          |
| enabled             | True                             |
| id                  | fa742015a6494a949f67629884fc7ec8 |
| name                | placement                        |
| options             | {}                               |
| password_expires_at | None                             |
+---------------------+----------------------------------+
</code></pre>
<p>3)Add the Placement user to the service project with the admin role:</p>
<pre><code>$ openstack role add –project service –user placement admin
</code></pre>
<p>4)Create a Placement API entry in the service catalog:</p>
<pre><code>$ openstack service create --name placement \
--description &quot;Placement API&quot; placement

+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | Placement API                    |
| enabled     | True                             |
| id          | 2d1a27022e6e4185b86adac4444c495f |
| name        | placement                        |
| type        | placement                        |
+-------------+----------------------------------+
</code></pre>
<p>5)Create the Placement API service endpoint:</p>
<pre><code>$ openstack endpoint create --region RegionOne \
placement public http://controller:8778

+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 2b1b2637908b4137a9c2e0470487cbc0 |
| interface    | public                           |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 2d1a27022e6e4185b86adac4444c495f |
| service_name | placement                        |
| service_type | placement                        |
| url          | http://controller:8778           |
+--------------+----------------------------------+

$ openstack endpoint create --region RegionOne \
placement internal http://controller:8778

+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 02bcda9a150a4bd7993ff4879df971ab |
| interface    | internal                         |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 2d1a27022e6e4185b86adac4444c495f |
| service_name | placement                        |
| service_type | placement                        |
| url          | http://controller:8778           |
+--------------+----------------------------------+

$ openstack endpoint create --region RegionOne \
placement admin http://controller:8778

+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 3d71177b9e0f406f98cbff198d74b182 |
| interface    | admin                            |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 2d1a27022e6e4185b86adac4444c495f |
| service_name | placement                        |
| service_type | placement                        |
| url          | http://controller:8778           |
+--------------+----------------------------------+
</code></pre>
<p>3 Install and configure components</p>
<p>1)Installation package:</p>
<pre><code>yum install openstack-placement-api
</code></pre>
<p>Edit the /etc/placement/placement.conf file and complete the following:</p>
<p>2)In the [placement_database] section, configure database access:</p>
<pre><code>[placement_database]

…
connection = mysql+pymysql://placement:PLACEMENT_DBPASS@controller/placement
replace PLACEMENT_DBPASS with the password you chose for the placement database.
</code></pre>
<p>3)In the [api] and [keystone_authtoken] sections, configure the identity service access:</p>
<pre><code>[api]
# ...
auth_strategy = keystone

[keystone_authtoken]
# ...
auth_url = http://controller:5000/v3
memcached_servers = controller:11211
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = placement
password = PLACEMENT_PASS
</code></pre>
<p>4 Populate the placement database:</p>
<pre><code>su -s /bin/sh -c &quot;placement-manage db sync&quot; placement
</code></pre>
<p>5 Complete the installation</p>
<p>Restart the httpd service</p>
<pre><code>systemctl restart httpd
</code></pre>
<p>Instructions
1 Resource provider aggregates function</p>
<p>Resource provider aggregates is a function similar to Host Aggregate. When obtaining Allocation Candidates, it supports obtaining from a specific Aggregate through the member_of request query parameter. Resource provider aggregates are very suitable for production scenarios with different types of host aggregation (eg high-performance host aggregation, large storage capacity host aggregation).</p>
<p>Create resource provider aggregates</p>
<pre><code>[root@control01 ~]# openstack aggregate create --zone nova host_aggregate_1
+-------------------+----------------------------+
| Field             | Value                      |
+-------------------+----------------------------+
| availability_zone | nova                       |
| created_at        | 2018-12-08T05:49:55.051678 |
| deleted           | False                      |
| deleted_at        | None                       |
| id                | 1                          |
| name              | host_aggregate_1           |
| updated_at        | None                       |
+-------------------+----------------------------+

[root@control01 ~]# openstack aggregate add host host_aggregate_1 control01
+-------------------+---------------------------------+
| Field             | Value                           |
+-------------------+---------------------------------+
| availability_zone | nova                            |
| created_at        | 2018-12-08T05:49:55.000000      |
| deleted           | False                           |
| deleted_at        | None                            |
| hosts             | [u'control01']                  |
| id                | 1                               |
| metadata          | {u'availability_zone': u'nova'} |
| name              | host_aggregate_1                |
| updated_at        | None                            |
+-------------------+---------------------------------+

[root@control01 ~]# openstack aggregate show host_aggregate_1
+-------------------+----------------------------+
| Field             | Value                      |
+-------------------+----------------------------+
| availability_zone | nova                       |
| created_at        | 2018-12-08T05:49:55.000000 |
| deleted           | False                      |
| deleted_at        | None                       |
| hosts             | [u'control01']             |
| id                | 1                          |
| name              | host_aggregate_1           |
| properties        |                            |
| updated_at        | None                       |
+-------------------+----------------------------+

[root@control01 ~]# openstack resource provider list
+--------------------------------------+-----------+------------+--------------------------------------+----------------------+
| uuid                                 | name      | generation | root_provider_uuid                   | parent_provider_uuid |
+--------------------------------------+-----------+------------+--------------------------------------+----------------------+
| 5c5a578f-51b0-481c-b38c-7aaa3394e585 | control01 |         26 | 5c5a578f-51b0-481c-b38c-7aaa3394e585 | None                 |
+--------------------------------------+-----------+------------+--------------------------------------+----------------------+

[root@control01 ~]# openstack resource provider aggregate list 5c5a578f-51b0-481c-b38c-7aaa3394e585
+--------------------------------------+
| uuid                                 |
+--------------------------------------+
| 5eea7084-0207-44f0-bbeb-c759e8c766a1 |
+--------------------------------------+
</code></pre>
<p>List allocation candidates filter by aggregates</p>
<pre><code># REQ
curl -i &quot;http://172.18.22.222/placement/allocation_candidates?resources=VCPU:1,MEMORY_MB:512,DISK_GB:5&amp;member_of=5eea7084-0207-44f0-bbeb-c759e8c766a1&quot; \
-X GET \
-H 'Content-type: application/json' \
-H 'Accept: application/json' \
-H 'X-Auth-Project-Id: admin' \
-H 'OpenStack-API-Version: placement 1.21' \
-H 'X-Auth-Token:gAAAAABcC12qN3GdLvjYXSSUODi7Dg9jTHUfcnF7I_ljmcffZjs3ignipGLj6iqDvDJ1gXkzGIDW6rRRNcXary-wPfgsb3nCWRIEiAS8LrReI4SYL1KfQiGW7j92b6zTz7RoSEBXACQ9z7UUVfeJ06n8WqVMBaSob4BeFIuHiVKpYCJNv7LR6cI'

# RESP
{
    &quot;provider_summaries&quot;: {
        &quot;5c5a578f-51b0-481c-b38c-7aaa3394e585&quot;: {
            &quot;traits&quot;: [&quot;HW_CPU_X86_SSE2&quot;, &quot;HW_CPU_X86_SSE&quot;, &quot;HW_CPU_X86_MMX&quot;, &quot;HW_CPU_X86_SVM&quot;],
            &quot;resources&quot;: {
                &quot;VCPU&quot;: {
                    &quot;used&quot;: 5,
                    &quot;capacity&quot;: 512
                },
                &quot;MEMORY_MB&quot;: {
                    &quot;used&quot;: 3648,
                    &quot;capacity&quot;: 60670
                },
                &quot;DISK_GB&quot;: {
                    &quot;used&quot;: 7,
                    &quot;capacity&quot;: 49
                }
            }
        }
    },
    &quot;allocation_requests&quot;: [{
        &quot;allocations&quot;: {
            &quot;5c5a578f-51b0-481c-b38c-7aaa3394e585&quot;: {
                &quot;resources&quot;: {
                    &quot;VCPU&quot;: 1,
                    &quot;MEMORY_MB&quot;: 512,
                    &quot;DISK_GB&quot;: 5
                }
            }
        }
    }]
}
</code></pre>
<p>2 Resource traits function</p>
<p>Resource traits feature label function, used to identify the feature properties of Resource Provider, each Resource Provider has its own default traits, and also supports custom traits for the specified Resource Provider.</p>
<p>Resource traits is a very flexible design, similar to the role of &quot;tags&quot;. Users can build a &quot;tag cloud&quot; and decide to put a &quot;tag&quot; on a Resource Provider. It is an auxiliary tool for resource classification requirements.</p>
<pre><code>List traits
curl -i &quot;http://172.18.22.222/placement/traits&quot; \
-X GET \
-H 'Content-type: application/json' \
-H 'Accept: application/json' \
-H 'X-Auth-Project-Id: admin' \
-H 'OpenStack-API-Version: placement 1.21' \
-H 'X-Auth-Token:gAAAAABcC12qN3GdLvjYXSSUODi7Dg9jTHUfcnF7I_ljmcffZjs3ignipGLj6iqDvDJ1gXkzGIDW6rRRNcXary-wPfgsb3nCWRIEiAS8LrReI4SYL1KfQiGW7j92b6zTz7RoSEBXACQ9z7UUVfeJ06n8WqVMBaSob4BeFIuHiVKpYCJNv7LR6cI'

Create custom traits
curl -i &quot;http://172.18.22.222/placement/traits/CUSTOM_FANGUIJU_HOST&quot; \
-X PUT \
-H 'Content-type: application/json' \
-H 'Accept: application/json' \
-H 'X-Auth-Project-Id: admin' \
-H 'OpenStack-API-Version: placement 1.21' \
-H 'X-Auth-Token:gAAAAABcC12qN3GdLvjYXSSUODi7Dg9jTHUfcnF7I_ljmcffZjs3ignipGLj6iqDvDJ1gXkzGIDW6rRRNcXary-wPfgsb3nCWRIEiAS8LrReI4SYL1KfQiGW7j92b6zTz7RoSEBXACQ9z7UUVfeJ06n8WqVMBaSob4BeFIuHiVKpYCJNv7LR6cI'
NOTE：自定义 traits 建议以 CUSTOM_ 开头。

Update all traits for a specific resource provider
curl -i &quot;http://172.18.22.222/placement/resource_providers/5c5a578f-51b0-481c-b38c-7aaa3394e585/traits&quot; \
-X PUT \
-H 'Content-type: application/json' \
-H 'Accept: application/json' \
-H 'X-Auth-Project-Id: admin' \
-H 'OpenStack-API-Version: placement 1.21' \
-H 'X-Auth-Token:gAAAAABcC12qN3GdLvjYXSSUODi7Dg9jTHUfcnF7I_ljmcffZjs3ignipGLj6iqDvDJ1gXkzGIDW6rRRNcXary-wPfgsb3nCWRIEiAS8LrReI4SYL1KfQiGW7j92b6zTz7RoSEBXACQ9z7UUVfeJ06n8WqVMBaSob4BeFIuHiVKpYCJNv7LR6cI' \
-d '{&quot;resource_provider_generation&quot;: 28, &quot;traits&quot;: [&quot;HW_CPU_X86_SSE2&quot;, &quot;HW_CPU_X86_SSE&quot;, &quot;HW_CPU_X86_MMX&quot;, &quot;HW_CPU_X86_SVM&quot;, &quot;CUSTOM_FANGUIJU_HOST&quot;]}'

Return all traits associated with a specific resource provider
[root@control01 ~]# openstack resource provider trait list 5c5a578f-51b0-481c-b38c-7aaa3394e585
+----------------------+
| name                 |
+----------------------+
| HW_CPU_X86_SSE2      |
| HW_CPU_X86_SSE       |
| HW_CPU_X86_MMX       |
| HW_CPU_X86_SVM       |
| CUSTOM_FANGUIJU_HOST |
+----------------------+
</code></pre>
<p>List allocation candidates filter by traits</p>
<pre><code># REQ
curl -i &quot;http://172.18.22.222/placement/allocation_candidates?resources=VCPU:1,MEMORY_MB:512,DISK_GB:5&amp;member_of=5eea7084-0207-44f0-bbeb-c759e8c766a1&amp;required=CUSTOM_FANGUIJU_HOST&quot; \
-X GET \
-H 'Content-type: application/json' \
-H 'Accept: application/json' \
-H 'X-Auth-Project-Id: admin' \
-H 'OpenStack-API-Version: placement 1.21' \
-H 'X-Auth-Token:gAAAAABcC12qN3GdLvjYXSSUODi7Dg9jTHUfcnF7I_ljmcffZjs3ignipGLj6iqDvDJ1gXkzGIDW6rRRNcXary-wPfgsb3nCWRIEiAS8LrReI4SYL1KfQiGW7j92b6zTz7RoSEBXACQ9z7UUVfeJ06n8WqVMBaSob4BeFIuHiVKpYCJNv7LR6cI'

# RESP
{
    &quot;provider_summaries&quot;: {
        &quot;5c5a578f-51b0-481c-b38c-7aaa3394e585&quot;: {
            &quot;traits&quot;: [&quot;HW_CPU_X86_SSE2&quot;, &quot;HW_CPU_X86_SSE&quot;, &quot;HW_CPU_X86_MMX&quot;, &quot;HW_CPU_X86_SVM&quot;, &quot;CUSTOM_FANGUIJU_HOST&quot;],
            &quot;resources&quot;: {
                &quot;VCPU&quot;: {
                    &quot;used&quot;: 5,
                    &quot;capacity&quot;: 512
                },
                &quot;MEMORY_MB&quot;: {
                    &quot;used&quot;: 3648,
                    &quot;capacity&quot;: 60670
                },
                &quot;DISK_GB&quot;: {
                    &quot;used&quot;: 7,
                    &quot;capacity&quot;: 49
                }
            }
        }
    },
    &quot;allocation_requests&quot;: [{
        &quot;allocations&quot;: {
            &quot;5c5a578f-51b0-481c-b38c-7aaa3394e585&quot;: {
                &quot;resources&quot;: {
                    &quot;VCPU&quot;: 1,
                    &quot;MEMORY_MB&quot;: 512,
                    &quot;DISK_GB&quot;: 5
                }
            }
        }
    }]
}
</code></pre>
<h1 id="summarize"><a class="header" href="#summarize">Summarize</a></h1>
<p>The project is still relatively young, and many functions have not been fully implemented. The Stein version has become an independent project for the first time. Although placement only replaces several commonly used filters of nova-scheduler's CpuFilter, CoreFilter and DiskFilter, it is expected that it will eventually replace nova in the future. -scheduler service and can conveniently use, manage, and monitor the system resources of the entire OpenStack.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../SUMMARY.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../openstack/power-arch.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../SUMMARY.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../openstack/power-arch.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../sidebar.js"></script>
    </body>
</html>